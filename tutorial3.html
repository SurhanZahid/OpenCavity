<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial 3 - Using apertures and phase masks &mdash; OpenCavity 0.1 Pre-Alpha documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1 Pre-Alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenCavity 0.1 Pre-Alpha documentation" href="index.html" />
    <link rel="next" title="Tutorial 4 - Calculating the output beam" href="tutorial4.html" />
    <link rel="prev" title="Tutorial 2 - General 1D cavity" href="tutorial2.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial4.html" title="Tutorial 4 - Calculating the output beam"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial2.html" title="Tutorial 2 - General 1D cavity"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">OpenCavity 0.1 Pre-Alpha documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-3-using-apertures-and-phase-masks">
<span id="tuto3-label"></span><h1>Tutorial 3 - Using apertures and phase masks<a class="headerlink" href="#tutorial-3-using-apertures-and-phase-masks" title="Permalink to this headline">¶</a></h1>
<p>In the previous tutorial we have seen how to use ABCD matrix to define a linear simple two mirrors cavity, at this point you should be able to define and find
the modes of a simple linear resonator, using ABCD matrix, this method is general and powerful and as we will see in next tutorials it can be used to
define more complex resonators scheme like a V-shaped , bow-tie cavities.
Nevertheless there are some configuration that cannot be defined using  ABCD matrix alone, fore example when we want to add an aperture somewhere inside
the cavity, or some amplitude or phase modulations (phase mask, diffractive elements, thermal lenses..etc). We can define such systems in OpenCavity by splitting the complex system to subsystems and applying phase mask or aperture, then cascade the subsystems
to make the global one. well let&#8217;s take some examples you should have a better picture after.</p>
<div class="section" id="plano-concave-cavity-using-phase-mask">
<h2>Plano concave cavity using phase mask<a class="headerlink" href="#plano-concave-cavity-using-phase-mask" title="Permalink to this headline">¶</a></h2>
<p>We stick with the cavity design we see in the first tutorial:
the optical resonator can be seen as a periodic sequence, the period or the round-trip is made of M1 the first mirror with radii of curvature R1
equivalent to a lens having a focal length of R1/2, then propagation distance Lc, then the second mirror R2 equivalent to f2=R2/2 and to close the
loop a second propagation distance Lc. The mirrors or the equivalent lenses are phase objects, so we can replace them by a phase discretized mask,
and use ABCD matrices for propagation, the system can be schematically described as follows:</p>
<blockquote>
<div><ul class="simple">
<li>phase mask1 -&gt; propagation Lc -&gt; phase mask 2 -&gt; propagation distance Lc</li>
</ul>
</div></blockquote>
<img alt="_images/Optical_cavity_mask.png" src="_images/Optical_cavity_mask.png" />
<p>Phase mask 1 is the one of plane mirror so it is just uniform plane equal to one, and phase mask 2 is the transfer function of a thin lens with focal
length f2=R2/2. The last two things to know before start coding are:</p>
<blockquote>
<div><ul class="simple">
<li>OpenCavity allows to apply phase/amplitude masks directly on already built Kernel</li>
<li>The phase /amplitude masks can be applied only on the first plane of the system. for example if a given system is made of say 3 elements a
mirror M1 then distance L then a lens F, if we apply a phase mask to the kernel of the global system, its phase will be applied on the first
mirror M1. If you want to apply a mask, say to the last plane just make it the starting plane of the next subsystem.</li>
</ul>
</div></blockquote>
<p>Knowing this, to define our plano-concave cavity using two subsystems we proceed the following way:</p>
<blockquote>
<div><ol class="arabic simple">
<li>sub-system1: Plane mirror -&gt; propagation -&gt; apply phase mask 1</li>
<li>sub-system2: plane mirror -&gt; propagation -&gt; apply phase mask 2</li>
<li>global-system = cascade(sub-system1, subsystem2)</li>
<li>solve global-system</li>
</ol>
</div></blockquote>
<p>It is time to stop talking and start acting, here is the code:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">opencavity.modesolver</span> <span class="kn">as</span> <span class="nn">ms</span>

<span class="gp">In [2]: </span><span class="n">R1</span><span class="o">=</span><span class="mf">1e13</span><span class="p">;</span> <span class="n">R2</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">Lc</span><span class="o">=</span><span class="mi">8</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">npts</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">a</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span> <span class="c"># cavity parameters; R1 very large = plane mirror</span>

<span class="gp">In [3]: </span><span class="n">A1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">B1</span><span class="o">=</span><span class="n">Lc</span><span class="p">;</span> <span class="n">C1</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">D1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">f</span><span class="o">=</span><span class="n">R2</span><span class="o">/</span><span class="mi">2</span> <span class="c">#ABCD matrix of propagation  anf focal length =R2/2</span>

<span class="gp">In [4]: </span><span class="n">sys1</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">();</span>

<span class="gp">In [5]: </span><span class="n">sys2</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">();</span>

<span class="gp">In [6]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A1</span><span class="p">,</span><span class="n">B1</span><span class="p">,</span><span class="n">C1</span><span class="p">,</span><span class="n">D1</span><span class="p">)</span> <span class="c"># system containing just propagation distance</span>

<span class="gp">In [7]: </span><span class="n">sys2</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A1</span><span class="p">,</span><span class="n">B1</span><span class="p">,</span><span class="n">C1</span><span class="p">,</span><span class="n">D1</span><span class="p">)</span> <span class="c"># system containing just propagation distance, we don&#39;t apply phase mask of plane mirror it is just &#39;1&#39;</span>

<span class="gp">In [8]: </span><span class="n">T_lens</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">1j</span><span class="o">*</span><span class="n">sys2</span><span class="o">.</span><span class="n">k</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="p">))</span><span class="o">*</span><span class="n">sys2</span><span class="o">.</span><span class="n">x1</span><span class="o">**</span><span class="mi">2</span><span class="p">);</span> <span class="c"># transfer function (phase mask) of a focusing lens, sys.k is the  wave-vector</span>

<span class="gp">In [9]: </span><span class="n">sys2</span><span class="o">.</span><span class="n">apply_mask1D</span><span class="p">(</span><span class="n">T_lens</span><span class="p">);</span> <span class="c"># apply a phase mask to the second system = focusing + propagation</span>
<span class="go">Applying 1D Mask...</span>
<span class="go">Mask applied.</span>

<span class="gp">In [10]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">cascade_subsystem</span><span class="p">(</span><span class="n">sys2</span><span class="p">)</span>
<span class="go">systems cascaded.</span>

<span class="gp">In [11]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">solve_modes</span><span class="p">()</span>
<span class="go">running the eigenvalues solver...</span>

<span class="gp">In [12]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [13]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>

<span class="gp">In [14]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>

<span class="gp">In [15]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>

<span class="gp">In [16]: </span><span class="n">ms</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto3_plot_mode0_E_1D_msk.png"><img alt="_images/tuto3_plot_mode0_E_1D_msk.png" src="_images/tuto3_plot_mode0_E_1D_msk.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto3_plot_mode0_P_1D_msk.png"><img alt="_images/tuto3_plot_mode0_P_1D_msk.png" src="_images/tuto3_plot_mode0_P_1D_msk.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto3_plot_mode2_I_1D_msk.png"><img alt="_images/tuto3_plot_mode2_I_1D_msk.png" src="_images/tuto3_plot_mode2_I_1D_msk.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto3_plot_mode2_P_1D_msk.png"><img alt="_images/tuto3_plot_mode2_P_1D_msk.png" src="_images/tuto3_plot_mode2_P_1D_msk.png" style="width: 4in;" /></a>
</div>
<div class="section" id="notes-on-vectors-spacing-in-opencavity">
<span id="vector-spacing-label"></span><h2>Notes on vectors spacing in OpenCavity<a class="headerlink" href="#notes-on-vectors-spacing-in-opencavity" title="Permalink to this headline">¶</a></h2>
<p>When we used OpenCavity to build a matrix Kernel for an optical cavity using the function
<code class="docutils literal"><span class="pre">build_1D_cav(a,</span> <span class="pre">npts,</span> <span class="pre">R1,</span> <span class="pre">R2,</span> <span class="pre">Lc)</span></code> , where <code class="docutils literal"><span class="pre">a</span></code> is the half-size of the calculation zone which contains <code class="docutils literal"><span class="pre">npts</span></code> points.
beside building the matrix kernel for the system this function creates two vectors x1,x2 which are the abscissas of the first
and the last planes of the system, as you can see in the code we used this abscissas vector <code class="docutils literal"><span class="pre">sys.x1</span></code> to create a phase mask.
The question is why bothering and create these vectors when it is too easy to generate linearly spaced vector from <code class="docutils literal"><span class="pre">-a</span></code> to <code class="docutils literal"><span class="pre">+a</span></code>
containing <code class="docutils literal"><span class="pre">npts</span></code> elements. The answer is: because these two vectors are not linearly spaced, indeed to build the Matrix-kernel,
OpenCavity transforms the Fresnel propagation integral to an exact some using the Legendre-Gauss quadrature scheme, thus  the
vectors contain Legendre-Gauss nodes thereby the resolved modes are also calculated at these points.</p>
</div>
<div class="section" id="inserting-an-aperture-inside-the-cavity">
<h2>inserting an aperture inside the cavity<a class="headerlink" href="#inserting-an-aperture-inside-the-cavity" title="Permalink to this headline">¶</a></h2>
<p>Now we will use the sub-systems cascading function to add an aperture inside the cavity to filter high order modes.</p>
<img alt="_images/Optical_cavity_aperture.png" src="_images/Optical_cavity_aperture.png" />
<p>let&#8217;s take the same example and take a look at the round trip losses of the first and the second modes.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [17]: </span><span class="n">l0</span><span class="p">,</span><span class="n">v0</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c">#l: eigenvalue; v: eigenmode</span>

<span class="gp">In [18]: </span><span class="n">l1</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">In [19]: </span><span class="k">print</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="go">(1.3307139324902906e-06, 3.8373526170309979e-05)</span>

<span class="gp">In [20]: </span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l0</span><span class="p">)</span><span class="o">-</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
<span class="gr">Out[20]: </span><span class="mf">1.8521589967068763e-05</span>
</pre></div>
</div>
<p>As we can see the two modes are very well confined (have very low losses = 1-abs(l)²) and the differences between them is just negligible.</p>
<p>The idea here is to introduce an aperture with a size that allows to the fundamental mode (but not the second) to pass without losses. Remember every mask or phase amplitude have to be defined at Legendre-Gauss quadrature nodes, which means merely system.x1 (and system.y1 for 2D systems).
We take the same code of the first example an we create and add an aperture:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="c"># calculate transfer matrices</span>
<span class="gp">In [21]: </span><span class="kn">import</span> <span class="nn">opencavity.modesolver</span> <span class="kn">as</span> <span class="nn">ms</span>

<span class="gp">In [22]: </span><span class="n">R1</span><span class="o">=</span><span class="mf">1e13</span><span class="p">;</span> <span class="n">R2</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">Lc</span><span class="o">=</span><span class="mi">8</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">npts</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">a</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span> <span class="c"># cavity parameters; R1 very large = plane mirror</span>

<span class="gp">In [23]: </span><span class="n">A1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">B1</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">C1</span><span class="o">=-</span><span class="mi">2</span><span class="o">/</span><span class="n">R1</span><span class="p">;</span> <span class="n">D1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c">#concave mirror M1</span>

<span class="gp">In [24]: </span><span class="n">A2</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">B2</span><span class="o">=</span><span class="n">Lc</span><span class="p">;</span> <span class="n">C2</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">D2</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>    <span class="c">#propagation distance Lc</span>

<span class="gp">In [25]: </span><span class="n">A3</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">B3</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">C3</span><span class="o">=-</span><span class="mi">2</span><span class="o">/</span><span class="n">R2</span><span class="p">;</span> <span class="n">D3</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c">#concave mirror M2</span>

<span class="gp">In [26]: </span><span class="n">A4</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">B4</span><span class="o">=</span><span class="n">Lc</span><span class="p">;</span> <span class="n">C4</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">D4</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>    <span class="c">#propagation distance Lc</span>

<span class="gp">In [27]: </span><span class="n">M1</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">A1</span><span class="p">,</span><span class="n">B1</span> <span class="p">],[</span><span class="n">C1</span><span class="p">,</span> <span class="n">D1</span><span class="p">]]);</span> <span class="n">M2</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">A2</span><span class="p">,</span> <span class="n">B2</span><span class="p">],[</span><span class="n">C2</span><span class="p">,</span> <span class="n">D2</span><span class="p">]]);</span>

<span class="gp">In [28]: </span><span class="n">M3</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">A3</span><span class="p">,</span> <span class="n">B3</span><span class="p">],[</span><span class="n">C3</span><span class="p">,</span> <span class="n">D3</span><span class="p">]]);</span> <span class="n">M4</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">A4</span><span class="p">,</span> <span class="n">B4</span><span class="p">],[</span><span class="n">C4</span><span class="p">,</span> <span class="n">D4</span><span class="p">]]);</span>

<span class="gp">In [29]: </span><span class="n">M11</span><span class="o">=</span><span class="n">M2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">);</span> <span class="n">M22</span><span class="o">=</span><span class="n">M4</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M3</span><span class="p">);</span> <span class="c"># sub-system 2</span>

<span class="gp">In [30]: </span><span class="n">A11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c"># getting the members of subsystem 1 matrix</span>

<span class="gp">In [31]: </span><span class="n">A22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c"># getting the members of subsystem 2 matrix</span>

<span class="c"># enter transfer matrices to create a system</span>
<span class="gp">In [32]: </span><span class="n">sys1</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">();</span>

<span class="gp">In [33]: </span><span class="n">sys2</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">();</span>

<span class="gp">In [34]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A11</span><span class="p">,</span><span class="n">B11</span><span class="p">,</span><span class="n">C11</span><span class="p">,</span><span class="n">D11</span><span class="p">)</span> <span class="c">#</span>

<span class="gp">In [35]: </span><span class="n">sys2</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A22</span><span class="p">,</span><span class="n">B22</span><span class="p">,</span><span class="n">C22</span><span class="p">,</span><span class="n">D22</span><span class="p">)</span> <span class="c"># to reinitialize the sub-system</span>

<span class="c"># just a small loop to create an aperture (amplitude =0 (no transmission) if radius &gt;50 )</span>
<span class="gp">In [36]: </span><span class="n">aperture</span><span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>

<span class="gp">In [37]: </span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
<span class="gp">   ....:</span>     <span class="k">if</span> <span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
<span class="gp">   ....:</span>         <span class="n">aperture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
<span class="gp">   ....:</span> 
<span class="gp">   ....:</span> 

<span class="gp">In [38]: </span><span class="n">ms</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="gp">In [39]: </span><span class="n">ms</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span><span class="n">aperture</span><span class="p">);</span> <span class="c"># plots the aperture function</span>

<span class="gp">In [40]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">apply_mask1D</span><span class="p">(</span><span class="n">aperture</span><span class="p">);</span> <span class="c"># apply the aperture to the subsystem 1</span>
<span class="go">Applying 1D Mask...</span>
<span class="go">Mask applied.</span>

<span class="gp">In [41]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">cascade_subsystem</span><span class="p">(</span><span class="n">sys2</span><span class="p">)</span>
<span class="go">systems cascaded.</span>

<span class="gp">In [42]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">solve_modes</span><span class="p">()</span>
<span class="go">running the eigenvalues solver...</span>

<span class="gp">In [43]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>

<span class="gp">In [44]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto3_plot_aperture_1D_msk.png"><img alt="_images/tuto3_plot_aperture_1D_msk.png" src="_images/tuto3_plot_aperture_1D_msk.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto3_plot_mode0_E_1D_apert.png"><img alt="_images/tuto3_plot_mode0_E_1D_apert.png" src="_images/tuto3_plot_mode0_E_1D_apert.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto3_plot_mode1_P_1D_apert.png"><img alt="_images/tuto3_plot_mode1_P_1D_apert.png" src="_images/tuto3_plot_mode1_P_1D_apert.png" style="width: 4in;" /></a>
<p>well the fundamental mode still not perturbed, let&#8217;s see now the round-trip losses</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [45]: </span><span class="n">l0</span><span class="p">,</span><span class="n">v0</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c">#l: eigenvalue; v: eigenmode</span>

<span class="gp">In [46]: </span><span class="n">l1</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">In [47]: </span><span class="k">print</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="go">(0.014508132902636639, 0.14202874441174429)</span>
</pre></div>
</div>
<p>Now the fundamental mode has round-trip loses of 1.4% and the second mode 12.7% this makes possible to select only the the fundamental one for example if one put a gain medium with net gain = 5% inside this cavity only the fundamental mode survives.</p>
<p>A question now: in this example the aperture is inserted on the first mirror, what if we want to change its place to the second
mirror? Well as we said earlier in this tutorial when we use the function <code class="docutils literal"><span class="pre">apply_mask1D()</span></code> on a system this apply the mask on
the first plane of the system, if we take a look at the code above the <code class="docutils literal"><span class="pre">sys2</span></code> is the return-trip subsystem so it starts with
the second mirror, all what we have to do is to apply the phase mask to the second subsystem by changing the
line <code class="docutils literal"><span class="pre">sys1.apply_mask1D(aperture)</span></code> by <code class="docutils literal"><span class="pre">sys2.apply_mask1D(aperture)</span></code>. if you try this keep in mind that the mode size on
the second mirror is larger than in the plane one where waist is minimum, so the aperture size have to be change accordingly.</p>
<p>Now you know how to put a phase or amplitude element anywhere into the cavity by using and cascading subsystems. In the tutorial
we used a two simple phase and amplitude functions : thin lens transfer function and hard aperture function to find  the results
of the previous tutorial that we are already familiar with. But any mask can be used for example to introduce aberrations or absorbers into the cavity.</p>
</div>
<div class="section" id="the-cleaned-code">
<h2>The cleaned code<a class="headerlink" href="#the-cleaned-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">@author: M.seghilani</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">opencavity.modesolver</span> <span class="kn">as</span> <span class="nn">ms</span> 
   
   
<span class="n">R1</span><span class="o">=</span><span class="mf">1e13</span><span class="p">;</span> <span class="n">R2</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">Lc</span><span class="o">=</span><span class="mi">8</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">npts</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">a</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span> <span class="c"># cavity parameters; R1 very large = plane mirror</span>
<span class="n">A1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">B1</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">C1</span><span class="o">=-</span><span class="mi">2</span><span class="o">/</span><span class="n">R1</span><span class="p">;</span> <span class="n">D1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c">#concave mirror M1</span>
<span class="n">A2</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">B2</span><span class="o">=</span><span class="n">Lc</span><span class="p">;</span> <span class="n">C2</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">D2</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>    <span class="c">#propagation distance Lc</span>
   
<span class="n">A3</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">B3</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">C3</span><span class="o">=-</span><span class="mi">2</span><span class="o">/</span><span class="n">R2</span><span class="p">;</span> <span class="n">D3</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c">#concave mirror M2</span>
<span class="n">A4</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">B4</span><span class="o">=</span><span class="n">Lc</span><span class="p">;</span> <span class="n">C4</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">D4</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>    <span class="c">#propagation distance Lc</span>
<span class="n">M1</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">A1</span><span class="p">,</span><span class="n">B1</span> <span class="p">],[</span><span class="n">C1</span><span class="p">,</span> <span class="n">D1</span><span class="p">]]);</span> <span class="n">M2</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">A2</span><span class="p">,</span> <span class="n">B2</span><span class="p">],[</span><span class="n">C2</span><span class="p">,</span> <span class="n">D2</span><span class="p">]]);</span> 
<span class="n">M3</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">A3</span><span class="p">,</span> <span class="n">B3</span><span class="p">],[</span><span class="n">C3</span><span class="p">,</span> <span class="n">D3</span><span class="p">]]);</span> <span class="n">M4</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">A4</span><span class="p">,</span> <span class="n">B4</span><span class="p">],[</span><span class="n">C4</span><span class="p">,</span> <span class="n">D4</span><span class="p">]]);</span>

<span class="n">M11</span><span class="o">=</span><span class="n">M2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">);</span> <span class="n">M22</span><span class="o">=</span><span class="n">M4</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M3</span><span class="p">);</span> <span class="c"># sub-system 2 </span>
<span class="n">A11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c"># getting the members of subsystem 1 matrix</span>
<span class="n">A22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c"># getting the members of subsystem 2 matrix</span>
   
<span class="c"># enter transfer matrices to create a system</span>
   
<span class="n">sys1</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">();</span>  
<span class="n">sys2</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">();</span>
  
<span class="n">sys1</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A11</span><span class="p">,</span><span class="n">B11</span><span class="p">,</span><span class="n">C11</span><span class="p">,</span><span class="n">D11</span><span class="p">)</span> <span class="c">#</span>
<span class="n">sys2</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A22</span><span class="p">,</span><span class="n">B22</span><span class="p">,</span><span class="n">C22</span><span class="p">,</span><span class="n">D22</span><span class="p">)</span> <span class="c"># to reinitialize the sub-system </span>
   
<span class="c"># just a small loop to create an aperture (amplitude =0 (no transmission) if radius &gt;50 )</span>
<span class="n">aperture</span><span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
   
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
        <span class="n">aperture</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
      
<span class="n">ms</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>   <span class="c"># clear figure</span>
<span class="n">ms</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span><span class="n">aperture</span><span class="p">);</span> <span class="c"># plots the aperture function</span>
<span class="n">sys1</span><span class="o">.</span><span class="n">apply_mask1D</span><span class="p">(</span><span class="n">aperture</span><span class="p">);</span> <span class="c"># apply the aperture to the subsystem 1 =on the mirror 1</span>
<span class="c">#sys2.apply_mask1D(aperture); # apply the aperture to the subsystem 2 =on the mirror 2</span>
<span class="n">sys1</span><span class="o">.</span><span class="n">cascade_subsystem</span><span class="p">(</span><span class="n">sys2</span><span class="p">)</span>

<span class="n">sys1</span><span class="o">.</span><span class="n">solve_modes</span><span class="p">()</span>
<span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>
<span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>
 
<span class="n">l0</span><span class="p">,</span><span class="n">v0</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c">#l: eigenvalue; v: eigenmode</span>
<span class="n">l1</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ms</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial 3 - Using apertures and phase masks</a><ul>
<li><a class="reference internal" href="#plano-concave-cavity-using-phase-mask">Plano concave cavity using phase mask</a></li>
<li><a class="reference internal" href="#notes-on-vectors-spacing-in-opencavity">Notes on vectors spacing in OpenCavity</a></li>
<li><a class="reference internal" href="#inserting-an-aperture-inside-the-cavity">inserting an aperture inside the cavity</a></li>
<li><a class="reference internal" href="#the-cleaned-code">The cleaned code</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial2.html"
                        title="previous chapter">Tutorial 2 - General 1D cavity</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial4.html"
                        title="next chapter">Tutorial 4 - Calculating the output beam</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial3.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial4.html" title="Tutorial 4 - Calculating the output beam"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial2.html" title="Tutorial 2 - General 1D cavity"
             >previous</a> |</li>
        <li><a href="index.html">OpenCavity 0.1 Pre-Alpha documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, M.Seghilani.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
  </body>
</html>