<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial 7 - General 2D cavity design &mdash; OpenCavity 0.1 Pre-Alpha documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1 Pre-Alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenCavity 0.1 Pre-Alpha documentation" href="index.html" />
    <link rel="next" title="Tutorial 8 - 2D cavity with masks" href="tutorial8.html" />
    <link rel="prev" title="Tutorial 6 - A second ‘Bessel-Gauss’ cavity design" href="tutorial6.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial8.html" title="Tutorial 8 - 2D cavity with masks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial6.html" title="Tutorial 6 - A second ‘Bessel-Gauss’ cavity design"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">OpenCavity 0.1 Pre-Alpha documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-7-general-2d-cavity-design">
<span id="tuto7-label"></span><h1>Tutorial 7 - General 2D cavity design<a class="headerlink" href="#tutorial-7-general-2d-cavity-design" title="Permalink to this headline">¶</a></h1>
<p>In the previous tutorials we have seen how to define and calculate the modes of a given 1D optical cavity using ABCD transfer matrix definition. Now we
see how to do the same thing but to design and calculate the modes of 2D optical cavity. The system definition procedure is quite similar as shown below.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">opencavity.modesolver</span> <span class="kn">as</span> <span class="nn">ms</span><span class="p">;</span> <span class="c">#importing the opencavity module</span>

<span class="gp">In [2]: </span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="gp">In [3]: </span><span class="n">R1</span><span class="o">=</span><span class="mf">1e13</span><span class="p">;</span> <span class="n">R2</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">Lc</span><span class="o">=</span><span class="mi">8</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">npts</span><span class="o">=</span><span class="mi">64</span><span class="p">;</span> <span class="n">a</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="c"># cavity parameters</span>

<span class="gp">In [4]: </span><span class="n">M1</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>   <span class="c">#concave mirror M1</span>

<span class="gp">In [5]: </span><span class="n">M2</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lc</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>  <span class="c">#propagation distance Lc</span>

<span class="gp">In [6]: </span><span class="n">M3</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> <span class="c">#concave mirror M2</span>

<span class="gp">In [7]: </span><span class="n">M4</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lc</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> <span class="c">#propagation distance Lc</span>

<span class="gp">In [8]: </span><span class="n">M</span><span class="o">=</span><span class="n">M4</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M3</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span> <span class="c"># calculating the global matrix (note the inversed order)</span>

<span class="gp">In [9]: </span><span class="n">A</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="gp">In [10]: </span><span class="n">opsys</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">()</span> <span class="c">#creating a ms object</span>
</pre></div>
</div>
<p>so far we are doing exactly the same thing as in previous tutorials, the change comes next: instead of using <code class="docutils literal"><span class="pre">opsys.build_1D_cav_ABCD(a,npts,A,B,C,D)</span></code>
we use <code class="docutils literal"><span class="pre">opsys.build_2D_cav_ABCD(a,npts,A,B,C,D)</span></code></p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [11]: </span><span class="n">opsys</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">()</span> <span class="c">#creating a ms object</span>

<span class="gp">In [12]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">build_2D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
<span class="go">Building the  kernel matrix ...</span>
<span class="go">Building the  kernel matrix done.</span>

<span class="gp">In [13]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">solve_modes</span><span class="p">()</span>
<span class="go">running the eigenvalues solver...</span>
</pre></div>
</div>
<p>Now to see the first 4 modes Amplitude or intensity and phase profiles:</p>
<ul class="simple">
<li>Fundamental mode (TEM00) amplitude and phase profile:</li>
</ul>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [14]: </span><span class="n">plt</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="s">&#39;hot&#39;</span><span class="p">)</span>

<span class="gp">In [15]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [16]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto7_plot_tem00_E_2D1.png"><img alt="_images/tuto7_plot_tem00_E_2D1.png" src="_images/tuto7_plot_tem00_E_2D1.png" style="width: 3.5in;" /></a>
<a class="reference internal image-reference" href="_images/tuto7_plot_tem00_P_2D.png"><img alt="_images/tuto7_plot_tem00_P_2D.png" src="_images/tuto7_plot_tem00_P_2D.png" style="width: 3.5in;" /></a>
<ul class="simple">
<li>TEM01 mode:</li>
</ul>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [17]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>

<span class="gp">In [18]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto7_plot_tem01_I_2D.png"><img alt="_images/tuto7_plot_tem01_I_2D.png" src="_images/tuto7_plot_tem01_I_2D.png" style="width: 3.5in;" /></a>
<a class="reference internal image-reference" href="_images/tuto7_plot_tem01_P_2D.png"><img alt="_images/tuto7_plot_tem01_P_2D.png" src="_images/tuto7_plot_tem01_P_2D.png" style="width: 3.5in;" /></a>
<ul class="simple">
<li>TEM10 mode:</li>
</ul>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [19]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>

<span class="gp">In [20]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto7_plot_tem02_I_2D.png"><img alt="_images/tuto7_plot_tem02_I_2D.png" src="_images/tuto7_plot_tem02_I_2D.png" style="width: 3.5in;" /></a>
<a class="reference internal image-reference" href="_images/tuto7_plot_tem02_P_2D.png"><img alt="_images/tuto7_plot_tem02_P_2D.png" src="_images/tuto7_plot_tem02_P_2D.png" style="width: 3.5in;" /></a>
<ul class="simple">
<li>And finally TEM11 mode:</li>
</ul>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [21]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>

<span class="gp">In [22]: </span><span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto7_plot_tem03_I_2D.png"><img alt="_images/tuto7_plot_tem03_I_2D.png" src="_images/tuto7_plot_tem03_I_2D.png" style="width: 3.5in;" /></a>
<a class="reference internal image-reference" href="_images/tuto7_plot_tem03_P_2D.png"><img alt="_images/tuto7_plot_tem03_P_2D.png" src="_images/tuto7_plot_tem03_P_2D.png" style="width: 3.5in;" /></a>
<p>To get the the round trip losses (1-abs(eigenvalue)^2):</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [23]: </span><span class="n">l</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">opsys</span><span class="o">.</span><span class="n">get_mode2D</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="c"># l: eigenvalue, v: eigenvector (the mode)</span>

<span class="gp">In [24]: </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="c"># in percent</span>
<span class="gr">Out[24]: </span><span class="mf">1.1188459936306572e-05</span>

<span class="gp">In [25]: </span><span class="n">l</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">opsys</span><span class="o">.</span><span class="n">get_mode2D</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="gp">In [26]: </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
<span class="gr">Out[26]: </span><span class="mf">0.00017114866894818448</span>
</pre></div>
</div>
<p>Using 2D cavity design offers more flexibility to simulate some effects, for example aberrations in laser mirrors, tilt, astigmatism...etc. It also allows
to design cavities with advanced phase/ amplitude masks. However you should be aware that the calculation method is memory-intensive because to build
the cavity kernel matrix each point in the final plane of the system need to do a double integration over all the starting plane, As explained earlier this
integration is transformed to a matrix product, thus in this tutorial for example we used 64 points which means that the starting plane contains 64x64
points, and the last plane 64x64, and for each point of the first we need to create a matrix of 64x64 we end up with a matrix-kernel of 64^4 = 16777216
complex elements, which needs 32 byte each, so the matrix kernel needs 537 Mb, and using a grid of 90x90 need 2.1 Gb of memory so if you want to design
a 2D system with very high resolution check that your available memory resources allow that. This said, a computer with 2Gb memory for example allows to accurately
simulate most of cavities design as we will see in the next tutorials.</p>
<div class="section" id="the-cleaned-code">
<h2>The cleaned code<a class="headerlink" href="#the-cleaned-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">opencavity.modesolver</span> <span class="kn">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span> <span class="c">#import numerical Python </span>

<span class="n">R1</span><span class="o">=</span><span class="mf">1e13</span><span class="p">;</span> <span class="n">R2</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">Lc</span><span class="o">=</span><span class="mi">8</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">npts</span><span class="o">=</span><span class="mi">64</span><span class="p">;</span> <span class="n">a</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="c"># cavity parameters</span>
<span class="n">M1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>   <span class="c">#concave mirror M1 </span>
<span class="n">M2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lc</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>  <span class="c">#propagation distance Lc</span>
<span class="n">M3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> <span class="c">#concave mirror M2</span>
<span class="n">M4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lc</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> <span class="c">#propagation distance Lc</span>
<span class="n">M</span><span class="o">=</span><span class="n">M4</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M3</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span> <span class="c"># calculating the global matrix (note the inversed order)</span>

<span class="n">A</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>   
<span class="n">opsys</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">()</span> <span class="c">#creating a Cavity eigensolver object</span>
<span class="n">opsys</span><span class="o">.</span><span class="n">build_2D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
<span class="n">opsys</span><span class="o">.</span><span class="n">solve_modes</span><span class="p">()</span>    

<span class="c"># show some modes </span>
<span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>
<span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>
<span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>
<span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>
<span class="n">opsys</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>

<span class="n">l</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">opsys</span><span class="o">.</span><span class="n">get_mode2D</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="c"># l: eigenvalue, v: eigenvector (the mode)</span>
<span class="k">print</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="c"># in percent</span>
<span class="n">l</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">opsys</span><span class="o">.</span><span class="n">get_mode2D</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="k">print</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> 

<span class="n">ms</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="calculating-the-output-mode">
<h2>Calculating the output mode<a class="headerlink" href="#calculating-the-output-mode" title="Permalink to this headline">¶</a></h2>
<p>In a similar way to tutorial 4 in this part we propagate the fundamental mode taking the output mirror into account to get the mode shape outside the
cavity. Let&#8217;s the same system as in tutorial 4</p>
<img alt="_images/Optical_cavity_output.png" src="_images/Optical_cavity_output.png" />
<p>As written earlier the ABCD matrix of this optical system is given by:</p>
<div class="math">
\[\begin{split}\begin{bmatrix} A &amp; B \\ C &amp; D \end{bmatrix}=
\begin{bmatrix} 1 &amp; d2 \\ 0 &amp; 1 \end{bmatrix}
\times \begin{bmatrix} 1 &amp; 1 \\ 0 &amp; n1/n0 \end{bmatrix}
\times \begin{bmatrix} 1 &amp; d1 \\ 0 &amp; 1 \end{bmatrix}
\times \begin{bmatrix} 1 &amp; 0 \\ \frac{(n0-n1)}{R2*n1} &amp; n0/n1 \end{bmatrix}
\times \begin{bmatrix} 1 &amp; Lc \\ 0 &amp; 1 \end{bmatrix}\end{split}\]</div>
<p>Entering these matrices and calculate the global one:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [27]: </span><span class="n">M00</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="n">Lc</span> <span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [28]: </span><span class="n">M01</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="p">],[(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">R2</span><span class="o">*</span><span class="mf">1.5</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="mf">1.5</span><span class="p">]]);</span><span class="c"># -R2  (&lt;0 because it is a concave interface)</span>

<span class="gp">In [29]: </span><span class="n">M02</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mf">5e3</span> <span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [30]: </span><span class="n">M03</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span> <span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">/</span><span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [31]: </span><span class="n">M04</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mf">50e3</span> <span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [32]: </span><span class="n">M_out</span><span class="o">=</span><span class="n">M04</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M03</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M02</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M01</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M00</span><span class="p">))));</span>
</pre></div>
</div>
<p>The difference from tutorial 4 is using <code class="docutils literal"><span class="pre">propagate2D_ABCD()</span></code> instead of <code class="docutils literal"><span class="pre">propagate1D_ABCD()</span></code> to propagate the beam.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [33]: </span><span class="kn">from</span> <span class="nn">opencavity.propagators</span> <span class="kn">import</span> <span class="n">FresnelProp</span>

<span class="gp">In [34]: </span><span class="n">propsys</span><span class="o">=</span><span class="n">FresnelProp</span><span class="p">()</span> <span class="c">#create propagator object</span>

<span class="gp">In [35]: </span><span class="n">l</span><span class="p">,</span><span class="n">tem00</span><span class="o">=</span><span class="n">opsys</span><span class="o">.</span><span class="n">get_mode2D</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c"># get the fundamental mode of the cavity</span>

<span class="gp">In [36]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">set_start_beam</span><span class="p">(</span><span class="n">tem00</span><span class="p">,</span> <span class="n">opsys</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span> <span class="c"># set the beam to propagate</span>
<span class="go">2D initial beam but y1 is missing..</span>
<span class="go">y1 is set = x1.</span>

<span class="gp">In [37]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">set_ABCD</span><span class="p">(</span><span class="n">M_out</span><span class="p">)</span> <span class="c"># taking M2 into account</span>

<span class="gp">In [38]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">propagate2D_ABCD</span><span class="p">(</span><span class="n">x2</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">opsys</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span> <span class="c"># calculate the propagation from initial plane to a plane 10 times larger (the beam is wider)</span>
<span class="go">calculating Fresnel propagation...</span>

<span class="gp">In [39]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">show_result_beam</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span> <span class="c"># show propagation result</span>

<span class="gp">In [40]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">show_result_beam</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto7_plot_propagate_tem00_2D_I.png"><img alt="_images/tuto7_plot_propagate_tem00_2D_I.png" src="_images/tuto7_plot_propagate_tem00_2D_I.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto7_plot_propagate_tem00_2D_P.png"><img alt="_images/tuto7_plot_propagate_tem00_2D_P.png" src="_images/tuto7_plot_propagate_tem00_2D_P.png" style="width: 4in;" /></a>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial 7 - General 2D cavity design</a><ul>
<li><a class="reference internal" href="#the-cleaned-code">The cleaned code</a></li>
<li><a class="reference internal" href="#calculating-the-output-mode">Calculating the output mode</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial6.html"
                        title="previous chapter">Tutorial 6 - A second &#8216;Bessel-Gauss&#8217; cavity design</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial8.html"
                        title="next chapter">Tutorial 8 - 2D cavity with masks</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial7.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial8.html" title="Tutorial 8 - 2D cavity with masks"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial6.html" title="Tutorial 6 - A second ‘Bessel-Gauss’ cavity design"
             >previous</a> |</li>
        <li><a href="index.html">OpenCavity 0.1 Pre-Alpha documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, M.Seghilani.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
  </body>
</html>