<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial 5 - An advanced cavity example ‘Bessel-Gauss’ cavity &mdash; OpenCavity 0.1 Pre-Alpha documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1 Pre-Alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenCavity 0.1 Pre-Alpha documentation" href="index.html" />
    <link rel="next" title="Tutorial 6 - A second ‘Bessel-Gauss’ cavity design" href="tutorial6.html" />
    <link rel="prev" title="Tutorial 4 - Calculating the output beam" href="tutorial4.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial6.html" title="Tutorial 6 - A second ‘Bessel-Gauss’ cavity design"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial4.html" title="Tutorial 4 - Calculating the output beam"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">OpenCavity 0.1 Pre-Alpha documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-5-an-advanced-cavity-example-bessel-gauss-cavity">
<span id="label-tuto5"></span><h1>Tutorial 5 - An advanced cavity example &#8216;Bessel-Gauss&#8217; cavity<a class="headerlink" href="#tutorial-5-an-advanced-cavity-example-bessel-gauss-cavity" title="Permalink to this headline">¶</a></h1>
<div class="section" id="small-introduction">
<h2>Small introduction<a class="headerlink" href="#small-introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we will design and calculate the eigenmodes of an advanced type of laser cavities called Bessel-Gauss cavities. This class of cavities
support Bessel-Gauss beams which offer some interesting properties, for example an extended depth of field with high intensity sometimes called
<em>non-diffracting region</em> and annular intensity distribution in the far field. These properties make this class of beams very interesting for several
applications such as biomedical imaging, particle trapping, strong-field applications...etc. Well, I hope that this small introduction motivates you to
learn more about these cavities. In the tutorial we will take the design studied in this open access paper <a class="reference internal" href="#schimpf2012" id="id1">[Schimpf2012]</a> which is a good one (I find)
to learn more about Bessel-Gauss beams and cavities and can be downloaded <a class="reference external" href="http://dx.doi.org/10.1364/OE.20.026852">here</a> ), this way we can compare
the results obtained using <strong>OpenCavity</strong> with those of the paper. Lets start with the scheme of the cavity:</p>
<a class="reference internal image-reference" href="_images/Bessel_cavity_scheme.png" id="bessel-cavity-fig"><img alt="_images/Bessel_cavity_scheme.png" class="align-center" id="bessel-cavity-fig" src="_images/Bessel_cavity_scheme.png" style="width: 5in;" /></a>
<p>As we can see this cavity contains concave mirror with radius of curvature R2=250mm and a conical reflector with base angle <span class="math">\(\alpha=0.5°\)</span>. the cavity
length Lc=78mm. This results in a ring-shaped mode with radius of 1.5mm at the first mirror. For more details about how to calculate the stability of
such a cavity take a look at the paper. To define this cavity we use general definition using ABCD transfer matrix and a phase mask to introduce the
conical phase function, using subsystems cascading as shown in <a class="reference internal" href="tutorial3.html#tuto3-label"><em>Tutorial 3 - using apertures and phase masks</em></a> as follows:</p>
</div>
<div class="section" id="cavity-design-using-opencavity">
<h2>Cavity design using OpenCavity<a class="headerlink" href="#cavity-design-using-opencavity" title="Permalink to this headline">¶</a></h2>
<p>Entering the cavity parameters and transfer matrices of the subsystems</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">opencavity.modesolver</span> <span class="kn">as</span> <span class="nn">ms</span>

<span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">opencavity.propagators</span> <span class="kn">import</span> <span class="n">FresnelProp</span>

<span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span> <span class="c">#import numerical Python</span>

<span class="gp">In [4]: </span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span> <span class="c"># import matplotlib to plot figures</span>

<span class="gp">In [5]: </span><span class="n">R1</span><span class="o">=</span><span class="mf">1e18</span><span class="p">;</span> <span class="n">R2</span><span class="o">=</span><span class="mi">250</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">Lc</span><span class="o">=</span><span class="mi">78</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">npts</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span> <span class="n">a</span><span class="o">=</span><span class="mi">2700</span><span class="p">;</span> <span class="c"># cavity parameters</span>

<span class="gp">In [6]: </span><span class="n">M1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>   <span class="c">#plane mirror M1</span>

<span class="gp">In [7]: </span><span class="n">M2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lc</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>  <span class="c">#propagation distance Lc</span>

<span class="gp">In [8]: </span><span class="n">M3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> <span class="c">#concave mirror M2</span>

<span class="gp">In [9]: </span><span class="n">M4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lc</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> <span class="c">#propagation distance Lc</span>

<span class="gp">In [10]: </span><span class="n">M11</span><span class="o">=</span><span class="n">M2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">);</span> <span class="n">M22</span><span class="o">=</span><span class="n">M4</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M3</span><span class="p">);</span> <span class="c"># sub-system 1 &amp; sub-system 2</span>

<span class="gp">In [11]: </span><span class="n">A11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c"># getting the members of subsystem 1 matrix</span>

<span class="gp">In [12]: </span><span class="n">A22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c"># getting the members of subsystem 2 matrix</span>
</pre></div>
</div>
<p>Creating the cavity-subsystems</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [13]: </span><span class="n">sys1</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="mf">1.04</span><span class="p">);</span> <span class="c"># working wavelength 1.04 micron</span>

<span class="gp">In [14]: </span><span class="n">sys2</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="mf">1.04</span><span class="p">);</span>

<span class="gp">In [15]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A11</span><span class="p">,</span><span class="n">B11</span><span class="p">,</span><span class="n">C11</span><span class="p">,</span><span class="n">D11</span><span class="p">)</span> <span class="c">#</span>

<span class="gp">In [16]: </span><span class="n">sys2</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A22</span><span class="p">,</span><span class="n">B22</span><span class="p">,</span><span class="n">C22</span><span class="p">,</span><span class="n">D22</span><span class="p">)</span> <span class="c"># to reinitialize the sub-system</span>
</pre></div>
</div>
<p>Creating the axicon function with base angle =-0.5°, <code class="docutils literal"><span class="pre">sys.k</span></code> is the wave vector, and remember that all the fields are not spaced linearly see (<a class="reference internal" href="tutorial3.html#vector-spacing-label"><em>Notes on vectors spacing in OpenCavity</em></a>)</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [17]: </span><span class="n">theta</span><span class="o">=-</span><span class="mf">0.5</span><span class="o">*</span><span class="mf">3.14</span><span class="o">/</span><span class="mi">180</span><span class="p">;</span><span class="c"># reflector is equivalent to refractive axicon with 2 x theta</span>

<span class="gp">In [18]: </span><span class="n">T_axicon</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">1j</span><span class="o">*</span><span class="n">sys1</span><span class="o">.</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">))</span><span class="o">*</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
</pre></div>
</div>
<p>Applying the axicon function and solve and show the modes</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [19]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">apply_mask1D</span><span class="p">(</span><span class="n">T_axicon</span><span class="p">)</span>
<span class="go">Applying 1D Mask...</span>
<span class="go">Mask applied.</span>

<span class="gp">In [20]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">cascade_subsystem</span><span class="p">(</span><span class="n">sys2</span><span class="p">)</span>
<span class="go">systems cascaded.</span>

<span class="gp">In [21]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">solve_modes</span><span class="p">()</span>
<span class="go">running the eigenvalues solver...</span>

<span class="gp">In [22]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>

<span class="gp">In [23]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>

<span class="gp">In [24]: </span><span class="n">l</span><span class="p">,</span><span class="n">tem00</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [25]: </span><span class="k">print</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c">#round trip losses</span>
<span class="go">0.0754566450443</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto5_plot_tem00_I_1D.png"><img alt="_images/tuto5_plot_tem00_I_1D.png" src="_images/tuto5_plot_tem00_I_1D.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto5_plot_tem00_P_1D.png"><img alt="_images/tuto5_plot_tem00_P_1D.png" src="_images/tuto5_plot_tem00_P_1D.png" style="width: 4in;" /></a>
<p>The first thing we can notice is that the mode contains two lobes, this is because it has a ring-shaped intensity distribution. And the second thing is the conical component in the
phase. The obtained mode is identical to the result of paper <em>(Fig 6-a)</em> and the lobe spacing is the one we expected :1.5mm (1500 micron in the figure).
Lets see the high order modes to complete the results of the <em>(Fig 6)</em>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [26]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>

<span class="gp">In [27]: </span><span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto5_plot_tem02_I_1D.png"><img alt="_images/tuto5_plot_tem02_I_1D.png" src="_images/tuto5_plot_tem02_I_1D.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto5_plot_tem04_P_1D.png"><img alt="_images/tuto5_plot_tem04_P_1D.png" src="_images/tuto5_plot_tem04_P_1D.png" style="width: 4in;" /></a>
<p>To see the high intensity region of these beams we use the <cite>FresnelProp()</cite> module presented in <a class="reference internal" href="tutorial4.html#tuto4-label"><em>Tutorial 4 - Calculating the output beam</em></a>, but this time we use a new function
<cite>propsys.yz_prop_chart(z_min,z_max,n_step,x)</cite> that calculates the propagated beam in <code class="docutils literal"><span class="pre">n_step</span></code> successive planes from <code class="docutils literal"><span class="pre">z_min</span></code> to <code class="docutils literal"><span class="pre">z_max</span></code> and <code class="docutils literal"><span class="pre">x</span></code> is the planes
abscissa.
However in this cavity arrangement the mode has already ring-shape at the first plane and is diverging, thus the high intensity region is behind the beam
so to see it we enter negative propagation distance (to follow the paper), obviously this does not have physical meaning in real word but mathematically it means that we merely
invert the time axis, or to consider a beam propagating from the right to the left.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [28]: </span><span class="n">propsys</span><span class="o">=</span><span class="n">FresnelProp</span><span class="p">()</span> <span class="c"># create a propagator object</span>

<span class="gp">In [29]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">set_start_beam</span><span class="p">(</span><span class="n">tem00</span><span class="p">,</span> <span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>

<span class="gp">In [30]: </span><span class="n">d</span><span class="o">=-</span><span class="mf">172.0e3</span>

<span class="gp">In [31]: </span><span class="n">M</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="n">d</span> <span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>

<span class="gp">In [32]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">set_ABCD</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

<span class="gp">In [33]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">yz_prop_chart</span><span class="p">(</span><span class="o">-</span><span class="mf">250e3</span><span class="p">,</span><span class="o">-</span><span class="mf">100e3</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c"># z_min=-250, z_max=-100, n_planes=100</span>

<span class="gp">In [34]: </span><span class="n">plt</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="s">&#39;hot&#39;</span><span class="p">)</span>

<span class="gp">In [35]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">show_prop_yz</span><span class="p">()</span>

<span class="c"># propagate the second mode</span>
<span class="gp">In [36]: </span><span class="n">l</span><span class="p">,</span><span class="n">tem02</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="gp">In [37]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">set_start_beam</span><span class="p">(</span><span class="n">tem02</span><span class="p">,</span> <span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>

<span class="gp">In [38]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">yz_prop_chart</span><span class="p">(</span><span class="o">-</span><span class="mf">250e3</span><span class="p">,</span><span class="o">-</span><span class="mf">100e3</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="gp">In [39]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">show_prop_yz</span><span class="p">()</span>

<span class="c"># propagate the third mode</span>
<span class="gp">In [40]: </span><span class="n">l</span><span class="p">,</span><span class="n">tem03</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="gp">In [41]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">set_start_beam</span><span class="p">(</span><span class="n">tem03</span><span class="p">,</span> <span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>

<span class="gp">In [42]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">yz_prop_chart</span><span class="p">(</span><span class="o">-</span><span class="mf">250e3</span><span class="p">,</span><span class="o">-</span><span class="mf">100e3</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="gp">In [43]: </span><span class="n">propsys</span><span class="o">.</span><span class="n">show_prop_yz</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tuto5_plot_tem01_yz_1D1.png"><img alt="_images/tuto5_plot_tem01_yz_1D1.png" src="_images/tuto5_plot_tem01_yz_1D1.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto5_plot_tem02_yz_1D.png"><img alt="_images/tuto5_plot_tem02_yz_1D.png" src="_images/tuto5_plot_tem02_yz_1D.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/tuto5_plot_tem03_yz_1D1.png"><img alt="_images/tuto5_plot_tem03_yz_1D1.png" src="_images/tuto5_plot_tem03_yz_1D1.png" style="width: 4in;" /></a>
<p>NB: As we are using Fresnel propagation method we can not calculate the propagation over small distances because this will break the paraxial condition
(small angles from the propagation axis) see (to add in the first part &#8216;before starting&#8217;). What we observe is that the high intensity region is behind
the conical mirror, after that the beam takes an annular shape and diverges as it propagates.
In the next tutorial we will change the cavity design to have the high intensity region after the concave mirror.</p>
</div>
<div class="section" id="the-cleaned-code">
<h2>The cleaned code<a class="headerlink" href="#the-cleaned-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">opencavity.modesolver</span> <span class="kn">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">opencavity.propagators</span> <span class="kn">import</span> <span class="n">FresnelProp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span> <span class="c">#import numerical Python </span>

<span class="n">R1</span><span class="o">=</span><span class="mf">1e18</span><span class="p">;</span> <span class="n">R2</span><span class="o">=</span><span class="mi">250</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">Lc</span><span class="o">=</span><span class="mi">78</span><span class="o">*</span><span class="mf">1e3</span><span class="p">;</span> <span class="n">npts</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span> <span class="n">a</span><span class="o">=</span><span class="mi">2700</span><span class="p">;</span> <span class="c"># cavity parameters</span>
<span class="n">M1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>   <span class="c">#concave mirror M1 </span>
<span class="n">M2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lc</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>  <span class="c">#propagation distance Lc</span>
<span class="n">M3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> <span class="c">#concave mirror M2</span>
<span class="n">M4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lc</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span> <span class="c">#propagation distance Lc</span>
<span class="n">M</span><span class="o">=</span><span class="n">M4</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M3</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span> <span class="c"># calculating the global matrix (note the inversed order)</span>

<span class="n">M11</span><span class="o">=</span><span class="n">M2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M1</span><span class="p">);</span> <span class="n">M22</span><span class="o">=</span><span class="n">M4</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M3</span><span class="p">);</span> <span class="c"># sub-system 2 </span>
<span class="n">A11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D11</span><span class="o">=</span><span class="n">M11</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c"># getting the members of subsystem 1 matrix</span>
<span class="n">A22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">B22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span> <span class="n">C22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">D22</span><span class="o">=</span><span class="n">M22</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c"># getting the members of subsystem 2 matrix</span>

<span class="n">sys1</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="mf">1.04</span><span class="p">);</span>  
<span class="n">sys2</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">CavEigenSys</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="mf">1.04</span><span class="p">);</span>

<span class="n">sys1</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A11</span><span class="p">,</span><span class="n">B11</span><span class="p">,</span><span class="n">C11</span><span class="p">,</span><span class="n">D11</span><span class="p">)</span> <span class="c">#</span>
<span class="n">sys2</span><span class="o">.</span><span class="n">build_1D_cav_ABCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">A22</span><span class="p">,</span><span class="n">B22</span><span class="p">,</span><span class="n">C22</span><span class="p">,</span><span class="n">D22</span><span class="p">)</span> <span class="c"># </span>

<span class="n">theta</span><span class="o">=-</span><span class="mf">0.5</span><span class="o">*</span><span class="mf">3.14</span><span class="o">/</span><span class="mi">180</span><span class="p">;</span><span class="c"># reflector is quivalent to refractive axcicon with 2 x theta</span>
<span class="n">T_axicon</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">+</span><span class="mi">1j</span><span class="o">*</span><span class="n">sys1</span><span class="o">.</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">))</span><span class="o">*</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>

<span class="n">sys1</span><span class="o">.</span><span class="n">apply_mask1D</span><span class="p">(</span><span class="n">T_axicon</span><span class="p">)</span>
<span class="n">sys1</span><span class="o">.</span><span class="n">cascade_subsystem</span><span class="p">(</span><span class="n">sys2</span><span class="p">)</span>

<span class="n">sys1</span><span class="o">.</span><span class="n">solve_modes</span><span class="p">()</span>

<span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>
<span class="n">sys1</span><span class="o">.</span><span class="n">show_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;phase&#39;</span><span class="p">)</span>
<span class="n">l</span><span class="p">,</span><span class="n">tem00</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">get_mode1D</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">propsys</span><span class="o">=</span><span class="n">FresnelProp</span><span class="p">()</span> <span class="c"># create a propagator object </span>
<span class="n">propsys</span><span class="o">.</span><span class="n">set_start_beam</span><span class="p">(</span><span class="n">tem00</span><span class="p">,</span> <span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span> 

<span class="n">d</span><span class="o">=-</span><span class="mf">172.0e3</span>
<span class="n">M</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="n">d</span> <span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>
<span class="n">propsys</span><span class="o">.</span><span class="n">set_ABCD</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="n">propsys</span><span class="o">.</span><span class="n">propagate1D_ABCD</span><span class="p">(</span><span class="n">x2</span><span class="o">=</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c"># propagate the beam</span>
<span class="n">propsys</span><span class="o">.</span><span class="n">show_result_beam</span><span class="p">()</span> 

<span class="n">propsys</span><span class="o">.</span><span class="n">yz_prop_chart</span><span class="p">(</span><span class="o">-</span><span class="mf">250e3</span><span class="p">,</span><span class="o">-</span><span class="mf">100e3</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">sys1</span><span class="o">.</span><span class="n">x1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">propsys</span><span class="o">.</span><span class="n">show_prop_yz</span><span class="p">()</span>
<span class="n">propsys</span><span class="o">.</span><span class="n">show_prop_yz</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s">&#39;intensity&#39;</span><span class="p">)</span>


<span class="n">ms</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="rubric">Bibliography</p>
<table class="docutils citation" frame="void" id="schimpf2012" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[Schimpf2012]</a></td><td>Schimpf, D. N., Schulte, J., Putnam, W. P., &amp; Franz, X. K. (2012). Generalizing higher-order Bessel-Gauss beams: analytical description and demonstration. Optics Express, 18(24), 24429–24443.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial 5 - An advanced cavity example &#8216;Bessel-Gauss&#8217; cavity</a><ul>
<li><a class="reference internal" href="#small-introduction">Small introduction</a></li>
<li><a class="reference internal" href="#cavity-design-using-opencavity">Cavity design using OpenCavity</a></li>
<li><a class="reference internal" href="#the-cleaned-code">The cleaned code</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial4.html"
                        title="previous chapter">Tutorial 4 - Calculating the output beam</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial6.html"
                        title="next chapter">Tutorial 6 - A second &#8216;Bessel-Gauss&#8217; cavity design</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial5.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial6.html" title="Tutorial 6 - A second ‘Bessel-Gauss’ cavity design"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial4.html" title="Tutorial 4 - Calculating the output beam"
             >previous</a> |</li>
        <li><a href="index.html">OpenCavity 0.1 Pre-Alpha documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, M.Seghilani.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
  </body>
</html>